"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4168],{4168:(P,c,s)=>{s.r(c),s.d(c,{ArPageModule:()=>k});var h=s(2200),f=s(4341),i=s(7343),m=s(8132),u=s(467),t=s(3664),g=s(3896),v=s(3690);let p=(()=>{var o;class r{constructor(e,a){this.storageService=e,this.authService=a,this.markers=[]}ngOnInit(){var e=this;return(0,u.A)(function*(){console.log("\u{1f3ac} AR Page iniciando..."),yield e.loadUserMarkers(),console.log("\u{1f4e6} Marcadores cargados:",e.markers.length),e.passMarkersToIframe()})()}loadUserMarkers(){var e=this;return(0,u.A)(function*(){const a=e.authService.currentUserValue;if(a)try{const n=yield e.storageService.listUserFiles(a.uid);n.success&&n.files&&(e.markers=n.files.filter(l=>".emptyFolderPlaceholder"!==l.name).map(l=>{const A=`https://bsojrhxindljlgpuwvmv.supabase.co/storage/v1/object/public/Taller-ar/${a.uid}/${l.name}`;return{name:l.name.replace(/\.[^/.]+$/,""),imageUrl:A,id:l.name.replace(/\.[^/.]+$/,"")}}),console.log("Marcadores cargados:",e.markers))}catch(n){console.error("Error cargando marcadores:",n)}})()}passMarkersToIframe(){console.log("\u{1f4e4} Pasando marcadores al iframe:",this.markers),localStorage.setItem("ar_user_markers",JSON.stringify(this.markers)),console.log("\u{1f4be} Guardado en localStorage:",localStorage.getItem("ar_user_markers")),setTimeout(()=>{const e=document.querySelector("iframe");e&&e.contentWindow?(console.log("\u{1f4e8} Enviando postMessage al iframe..."),e.contentWindow.postMessage({type:"LOAD_MARKERS",markers:this.markers},"*")):console.error("\u274c No se encontr\xf3 el iframe")},1e3)}static#e=o=()=>(this.\u0275fac=function(a){return new(a||r)(t.rXU(g.n),t.rXU(v.u))},this.\u0275cmp=t.VBU({type:r,selectors:[["app-ar"]],standalone:!1,decls:2,vars:0,consts:[["fullscreen",""],["src",t.wXG`assets/ar/ar-dynamic.html`,"allow","camera; fullscreen; autoplay",2,"width","100%","height","100%","border","none"]],template:function(a,n){1&a&&(t.j41(0,"ion-content",0),t.nrm(1,"iframe",1),t.k0s())},dependencies:[i.W9],encapsulation:2}))}return o(),r})();var d=s(2615);const y=[{path:"",component:p}];let M=(()=>{var o;class r{static#e=o=()=>(this.\u0275fac=function(a){return new(a||r)},this.\u0275mod=t.$C({type:r}),this.\u0275inj=d.G2t({imports:[m.iI.forChild(y),m.iI]}))}return o(),r})(),k=(()=>{var o;class r{static#e=o=()=>(this.\u0275fac=function(a){return new(a||r)},this.\u0275mod=t.$C({type:r}),this.\u0275inj=d.G2t({imports:[h.MD,f.YN,i.bv,M]}))}return o(),r})()}}]);